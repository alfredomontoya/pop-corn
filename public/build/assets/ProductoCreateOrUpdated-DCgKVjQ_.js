import{j as e,r as u,b as _,u as W,c as J}from"./app-CdaVaMdr.js";import{I as y}from"./input-B_XBTnPd.js";import{c as T,u as A,B as S}from"./button-DX4rUyCX.js";import{A as Y}from"./app-layout-DAxnsUqW.js";import{c as Z,u as K,d as L,l as ee}from"./index-TJCVTMuW.js";import{u as ae,C as M}from"./index-DQ_cOJ-6.js";import{c as re,X as B}from"./index-cFw2X6NW.js";import{P as I}from"./index-C-ZSrLmy.js";import{L as D}from"./label-BCEwSUMp.js";import{T as te}from"./TextArea-DolV8Crt.js";import{T as se}from"./Toast-Dk4FGC3x.js";import{F as oe}from"./FloatingCreateButton-B3oLO3So.js";import{c as P}from"./createLucideIcon-CJZ60ZCH.js";/* empty css            */import"./Edit-DNxWt32P.js";import"./index-BTX1XJQz.js";import"./app-logo-icon-DhLlcZEl.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ne=P("CircleCheck",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],le=P("Star",ie);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ue=P("TriangleAlert",de);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],pe=P("Upload",me);function he({className:l,...d}){return e.jsx("div",{"data-slot":"card",className:T("bg-card text-card-foreground flex flex-col gap-6 rounded-md border py-6 shadow-sm",l),...d})}function xe({items:l,labelKey:d,onSelect:s,selected:r,placeholder:n="Buscar...",displayKey:t,maxResults:p=5,error:h}){const[m,f]=u.useState(""),[i,x]=u.useState(!1),b=u.useRef(null),c=l.filter(a=>(t?t(a):String(a[d])).toLowerCase().includes(m.toLowerCase())).slice(0,p);return u.useEffect(()=>{const a=g=>{g.key==="Escape"&&x(!1)};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),u.useEffect(()=>{const a=g=>{b.current&&!b.current.contains(g.target)&&x(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),e.jsxs("div",{ref:b,className:"relative w-full",children:[!i&&e.jsxs(e.Fragment,{children:[e.jsx(he,{onClick:()=>x(!0),className:"cursor-pointer px-4 py-1 pt-2 text-gray-600",children:r?t?t(r):String(r[d]):n}),h&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h})]}),i&&e.jsxs("div",{className:"absolute z-10 w-full bg-white border rounded-md shadow-md",children:[e.jsx(y,{type:"text",value:m,onChange:a=>f(a.target.value),placeholder:n,autoFocus:!0}),e.jsxs("ul",{className:"max-h-60 overflow-y-auto",children:[c.map((a,g)=>e.jsx("li",{onClick:()=>{s(a),f(""),x(!1)},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:t?t(a):String(a[d])},g)),c.length===0&&e.jsx("li",{className:"px-4 py-2 text-gray-400",children:"No se encontraron resultados"})]})]})]})}var E="Checkbox",[ge,qe]=Z(E),[be,R]=ge(E);function fe(l){const{__scopeCheckbox:d,checked:s,children:r,defaultChecked:n,disabled:t,form:p,name:h,onCheckedChange:m,required:f,value:i="on",internal_do_not_use_render:x}=l,[b,c]=K({prop:s,defaultProp:n??!1,onChange:m,caller:E}),[a,g]=u.useState(null),[j,o]=u.useState(null),v=u.useRef(!1),w=a?!!p||!!a.closest("form"):!0,k={checked:b,disabled:t,setChecked:c,control:a,setControl:g,name:h,form:p,value:i,hasConsumerStoppedPropagationRef:v,required:f,defaultChecked:C(n)?!1:n,isFormControl:w,bubbleInput:j,setBubbleInput:o};return e.jsx(be,{scope:d,...k,children:ve(x)?x(k):r})}var $="CheckboxTrigger",q=u.forwardRef(({__scopeCheckbox:l,onKeyDown:d,onClick:s,...r},n)=>{const{control:t,value:p,disabled:h,checked:m,required:f,setControl:i,setChecked:x,hasConsumerStoppedPropagationRef:b,isFormControl:c,bubbleInput:a}=R($,l),g=A(n,i),j=u.useRef(m);return u.useEffect(()=>{const o=t?.form;if(o){const v=()=>x(j.current);return o.addEventListener("reset",v),()=>o.removeEventListener("reset",v)}},[t,x]),e.jsx(I.button,{type:"button",role:"checkbox","aria-checked":C(m)?"mixed":m,"aria-required":f,"data-state":G(m),"data-disabled":h?"":void 0,disabled:h,value:p,...r,ref:g,onKeyDown:L(d,o=>{o.key==="Enter"&&o.preventDefault()}),onClick:L(s,o=>{x(v=>C(v)?!0:!v),a&&c&&(b.current=o.isPropagationStopped(),b.current||o.stopPropagation())})})});q.displayName=$;var z=u.forwardRef((l,d)=>{const{__scopeCheckbox:s,name:r,checked:n,defaultChecked:t,required:p,disabled:h,value:m,onCheckedChange:f,form:i,...x}=l;return e.jsx(fe,{__scopeCheckbox:s,checked:n,defaultChecked:t,disabled:h,required:p,onCheckedChange:f,name:r,form:i,value:m,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{...x,ref:d,__scopeCheckbox:s}),b&&e.jsx(X,{__scopeCheckbox:s})]})})});z.displayName=E;var O="CheckboxIndicator",H=u.forwardRef((l,d)=>{const{__scopeCheckbox:s,forceMount:r,...n}=l,t=R(O,s);return e.jsx(re,{present:r||C(t.checked)||t.checked===!0,children:e.jsx(I.span,{"data-state":G(t.checked),"data-disabled":t.disabled?"":void 0,...n,ref:d,style:{pointerEvents:"none",...l.style}})})});H.displayName=O;var U="CheckboxBubbleInput",X=u.forwardRef(({__scopeCheckbox:l,...d},s)=>{const{control:r,hasConsumerStoppedPropagationRef:n,checked:t,defaultChecked:p,required:h,disabled:m,name:f,value:i,form:x,bubbleInput:b,setBubbleInput:c}=R(U,l),a=A(s,c),g=ae(t),j=ee(r);u.useEffect(()=>{const v=b;if(!v)return;const w=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(w,"checked").set,Q=!n.current;if(g!==t&&F){const V=new Event("click",{bubbles:Q});v.indeterminate=C(t),F.call(v,C(t)?!1:t),v.dispatchEvent(V)}},[b,g,t,n]);const o=u.useRef(C(t)?!1:t);return e.jsx(I.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??o.current,required:h,disabled:m,name:f,value:i,form:x,...d,tabIndex:-1,ref:a,style:{...d.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});X.displayName=U;function ve(l){return typeof l=="function"}function C(l){return l==="indeterminate"}function G(l){return C(l)?"indeterminate":l?"checked":"unchecked"}function je({className:l,...d}){return e.jsx(z,{"data-slot":"checkbox",className:T("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",l),...d,children:e.jsx(H,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(M,{className:"size-3.5"})})})}function N({label:l,placeholder:d,value:s,onChange:r,error:n,rule:t,type:p="text"}){return e.jsxs("div",{className:"relative w-full mb-4",children:[e.jsx(D,{children:l}),t&&e.jsx("span",{className:"text-gray-400 text-xs ms-2",children:t}),e.jsx(y,{type:p,placeholder:d,value:s,onChange:h=>r(h.target.value),className:"peer w-full border rounded-lg p-2 focus:outline-none"}),n&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:n})]})}const ke=({productoId:l,imagenesGuardadas:d,onUpdated:s})=>{const[r,n]=u.useState(d),[t,p]=u.useState([]),[h,m]=u.useState([]);u.useEffect(()=>{n(d)},[d]);const f=c=>{if(!c.target.files)return;const a=Array.from(c.target.files);m(a);const g=a.map(j=>URL.createObjectURL(j));p(g)},i=async()=>{if(!l||h.length===0)return;const c=new FormData;h.forEach(a=>c.append("imagenes[]",a));try{const{data:a}=await _.post(`/productos/${l}/storeImages`,c,{headers:{"Content-Type":"multipart/form-data"}});n(g=>[...g,...a.imagenes]),p([]),m([]),s?.("Imágenes guardadas correctamente")}catch(a){console.error("Error al subir imágenes:",a.response?.data||a.message),s?.("Error al subir imágenes")}},x=async c=>{if(c)try{const{data:a}=await _.delete(`/productoimagenes/${c}`);a.productoImagenes&&n(a.productoImagenes),s?.(a.message||"Imagen eliminada")}catch(a){console.error("Error al eliminar imagen:",a)}},b=async c=>{if(console.log("esPrincipal"),console.log(c),!!c)try{const a=await _.patch(`/productoimagenes/${c}/setPrincipal`);console.log("result"),console.log(a),n(g=>g.map(j=>({...j,es_principal:j.id===c}))),s?.("Imagen principal actualizada")}catch(a){console.error("Error al establecer imagen principal:",a)}};return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Imágenes del producto"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Configurar imágenes del producto"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(pe,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Seleccionar imágenes"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:f})]}),t.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4",children:t.map((c,a)=>e.jsx("img",{src:c,alt:`preview-${a}`,className:"w-full aspect-square rounded-xl overflow-hidden border border-gray-300 object-cover"},a))}),e.jsx(S,{className:"mt-2",onClick:i,children:"Guardar Imágenes"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4",children:r.map(c=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`w-full aspect-square rounded-xl overflow-hidden border ${c.es_principal?"border-blue-500":"border-gray-300"}`,children:e.jsx("img",{src:c.imagen.startsWith("http")?c.imagen:`/storage/${c.imagen}`,alt:`imagen-${c.id}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition",children:[e.jsx("button",{onClick:()=>x(c.id),className:"p-1 bg-red-500 text-white rounded-full shadow hover:bg-red-600",title:"Eliminar",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(c.id),className:`p-1 rounded-full shadow ${c.es_principal?"bg-yellow-400 text-black":"bg-gray-700 text-white hover:bg-yellow-400 hover:text-black"}`,title:"Establecer como principal",children:e.jsx(le,{className:"w-4 h-4"})})]}),!!c.es_principal&&e.jsx("span",{className:"absolute bottom-2 left-2 bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full shadow",children:"Principal"})]},c.id??c.imagen))})]})},Ce=({productoId:l,preciosGuardados:d,onUpdated:s})=>{const r=new Date().toISOString().split("T")[0],[n,t]=u.useState(d),[p,h]=u.useState({producto_id:l??void 0,precio_venta:0,precio_compra:0,activo:!0,fecha_inicio:r,fecha_fin:null});u.useEffect(()=>{t(d)},[d]);const m=(i,x)=>{h(b=>({...b,[i]:x}))},f=async()=>{if(l)try{const{data:i}=await _.post("/producto-precios",{...p,producto_id:l});console.log("Respuesta al agregar precio:",i),t(i.productoPrecios),h({precio_venta:0,precio_compra:0,activo:!0,fecha_inicio:r,fecha_fin:null}),s?.("Precio agregado correctamente")}catch(i){console.error("Error al agregar precio:",i.response?.data||i.message),s?.("Error al agregar precio")}};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Precios del producto"}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-2",children:[e.jsx(y,{type:"number",placeholder:"Precio venta",value:p.precio_venta,onChange:i=>m("precio_venta",parseFloat(i.target.value))}),e.jsx(y,{type:"number",placeholder:"Precio compra",value:p.precio_compra,onChange:i=>m("precio_compra",parseFloat(i.target.value))}),e.jsx(y,{type:"date",placeholder:"Fecha inicio",value:p.fecha_inicio??r,onChange:i=>m("fecha_inicio",i.target.value)})]}),e.jsx(S,{onClick:f,children:"Agregar precio"}),e.jsx("h2",{className:"text-xl font-semibold mb-2 mt-5",children:"Historial de precios"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto border border-gray-300 rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Precio venta"}),e.jsx("th",{className:"p-2 border",children:"Precio compra"}),e.jsx("th",{className:"p-2 border",children:"Activo"}),e.jsx("th",{className:"p-2 border",children:"Fecha inicio"}),e.jsx("th",{className:"p-2 border",children:"Fecha fin"})]})}),e.jsx("tbody",{children:n.map(i=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"p-2 border",children:i.precio_venta}),e.jsx("td",{className:"p-2 border",children:i.precio_compra}),e.jsx("td",{className:"p-2 border",children:i.activo?e.jsx(M,{className:"text-green-600 w-5 h-5 mx-auto"}):e.jsx(B,{className:"text-red-600 w-5 h-5 mx-auto"})}),e.jsx("td",{className:"p-2 border",children:i.fecha_inicio}),e.jsx("td",{className:"p-2 border",children:i.fecha_fin??"-"})]},i.id))})]})})]})},ze=({categorias:l,onSaved:d,producto:s})=>{const{data:r,setData:n,errors:t}=W({id:s?.id||null,nombre:s?.nombre||"",descripcion:s?.descripcion||"",categoria_id:s?.categoria_id||0,codigo:s?.codigo||null,stock_actual:s?.stock_actual||0,stock_minimo:s?.stock_minimo||0,unidad_medida:s?.unidad_medida||"",activo:s?.activo??!0,precio_compra:s?.precio_activo?.precio_compra??0,precio_venta:s?.precio_activo?.precio_venta??0,saludo:"Hola"}),{flash:p}=J().props,[h,m]=u.useState(p?.success||null),[f,i]=u.useState(s?.categoria||null),x=[{title:"Productos",href:"/productos"}],[b,c]=u.useState(!1),[a,g]=u.useState(r),j=()=>{const o=!!a?.id;console.log("initialData",a);const v=o?route("productos.update",a?.id):route("productos.store");_[o?"put":"post"](v,r).then(k=>{m(k.data.success),g({...r,id:k.data.producto.id}),n("id",k.data.producto.id),c(!1),d?.(k.data.success)}).catch(k=>{k.response?.status===422?console.log(k.response.data.errors):console.error(k)})};return u.useEffect(()=>{console.log("data changed:",r),console.log("initialData:",a);const o=r.nombre!==a.nombre||r.descripcion!==a.descripcion||r.codigo!==a.codigo||r.stock_actual!==a.stock_actual||r.stock_minimo!==a.stock_minimo||r.unidad_medida!==a.unidad_medida||r.activo!==a.activo||r.categoria_id!==a.categoria_id||Number(r.precio_venta)!==Number(a.precio_venta)||Number(r.precio_compra)!==Number(a.precio_compra);c(o)},[r,a]),e.jsxs(Y,{breadcrumbs:x,children:[e.jsx(oe,{}),e.jsxs("div",{className:"p-4",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:[a?.id?"Editar":"Crear"," Producto"," ",e.jsx("span",{className:"text--secondary",children:a?.id&&`#${a.id}`})]}),b?e.jsxs("div",{className:"mb-4 flex items-center gap-2 rounded-md bg-yellow-100 p-2 text-yellow-800 text-sm shadow",children:[e.jsx(ue,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{children:"Tienes cambios sin guardar"})]}):s?.id&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 rounded-md bg-green-100 p-2 text-green-800 text-sm shadow",children:[e.jsx(ne,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Producto guardado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(D,{className:"block text-sm font-medium",children:"Categoria"}),e.jsx(xe,{items:l,labelKey:"nombre",placeholder:"Buscar categoría",selected:f,onSelect:o=>{n("categoria_id",o.id),i(o)},error:t.categoria_id})]}),e.jsx("div",{children:e.jsx(N,{label:"Nombre",type:"text",placeholder:"Nombre del producto",value:r.nombre,onChange:o=>n("nombre",o),error:t.nombre})}),e.jsx("div",{children:e.jsx(N,{label:"Código",type:"text",placeholder:"Código del producto",value:r.codigo??"",onChange:o=>n("codigo",o),error:t.codigo})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx(te,{label:"Descripción",value:r.descripcion,placeholder:"Descripción del producto",onChange:o=>n("descripcion",o),error:t.descripcion})}),e.jsx("div",{children:e.jsx(N,{label:"Stock Actual",type:"number",value:r.stock_actual,onChange:o=>n("stock_actual",Number(o)),error:t.stock_actual})}),e.jsx("div",{children:e.jsx(N,{label:"Stock Mínimo",type:"number",value:r.stock_minimo,onChange:o=>n("stock_minimo",Number(o)),error:t.stock_minimo})}),e.jsx("div",{children:e.jsx(N,{label:"Unidad de Medida",type:"text",placeholder:"Ej: kg, unid, lt",value:r.unidad_medida,onChange:o=>n("unidad_medida",o),error:t.unidad_medida})}),e.jsx("div",{children:e.jsx(N,{label:"Precio de Compra",type:"number",value:r.precio_compra,onChange:o=>n("precio_compra",Number(o)),error:t.precio_compra})}),e.jsx("div",{children:e.jsx(N,{label:"Precio de Venta",type:"number",value:r.precio_venta,onChange:o=>n("precio_venta",Number(o)),error:t.precio_venta})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:"activo",name:"activo",checked:r.activo,onClick:()=>n("activo",!r.activo)}),e.jsx("label",{htmlFor:"activo",className:"text-sm",children:"Activo"})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(S,{variant:"default",onClick:j,children:"Guardar"})}),e.jsx("div",{className:"mb-6"}),e.jsx(ke,{productoId:s?.id||a.id,imagenesGuardadas:s?.imagenes||[],onUpdated:o=>{m(o)}}),e.jsx(Ce,{productoId:s?.id||a.id,preciosGuardados:s?.precios||[],onUpdated:o=>{m(o)}}),h&&e.jsx(se,{message:h,onClose:()=>m(null)})]})]})};export{ze as default};
