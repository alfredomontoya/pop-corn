import{r as d,b,j as e}from"./app-BptPjD3z.js";import{A as I}from"./app-layout-CmfWQkF8.js";import{c as T,b as O,B as f}from"./button-YlEUOrkT.js";import{D as S,a as _,b as D,c as E,d as F}from"./dialog-B1nusEzF.js";import{I as Y}from"./input-DcZ4YC8s.js";import{L}from"./label-BdaOFR1B.js";import{T as $}from"./TextArea-CRwfIsRn.js";import{d as M}from"./dayjs.min-ZkcwTcOi.js";/* empty css            */import"./Edit-DSh88ZNs.js";import"./index-CKqZ0YDH.js";import"./createLucideIcon-B3T4r_g0.js";import"./index-CX3o33-i.js";import"./index-CQYQARK0.js";import"./index-B1quYXf_.js";import"./app-logo-icon-BGFTalqf.js";function N(){const[l,t]=d.useState({data:[]}),[s,r]=d.useState(!1),[c,a]=d.useState({}),[o,h]=d.useState(""),x=async(i="/cajas")=>{try{r(!0),console.log("Fetching cajas...");const{data:n}=await b.get(i);t(n),h(n.fecha||"")}catch(n){console.error("Error al obtener cajas:",n)}finally{r(!1)}};return{cajas:l,loading:s,errors:c,fetchCajas:x,getCaja:async i=>{try{r(!0);const{data:n}=await b.get(`/cajas/${i}`);return n}catch(n){return console.error("Error al obtener caja:",n),a({msg:"No se pudo obtener el detalle de la caja"}),null}finally{r(!1)}},createCaja:async i=>{console.log("Creating caja with values:",i);try{return r(!0),a({}),await b.post("/cajas",i),!0}catch(n){const u=n;if(u.response?.status===422){const m=u.response.data;typeof m.errors=="object"?a(m.errors):m.message&&a({msg:m.message})}else console.error("Error al crear caja:",u),a({msg:"Error inesperado al crear la caja"});return!1}finally{r(!1)}},updateCaja:async(i,n)=>{try{return r(!0),a({}),await b.put(`/cajas/${i}`,n),await x(),!0}catch(u){const m=u;if(m.response?.status===422){const C=m.response.data;typeof C.errors=="object"?a(C.errors):C.message&&a({msg:C.message})}else a({msg:"Error inesperado al actualizar la caja"});return!1}finally{r(!1)}},deleteCaja:async i=>{if(!confirm("¿Seguro que deseas eliminar esta caja?"))return!1;try{return r(!0),await b.delete(`/cajas/${i}`),await x(),!0}catch(u){return console.error("Error al eliminar caja:",u),a({msg:"No se pudo eliminar la caja"}),!1}finally{r(!1)}},cerrarCaja:async i=>{try{r(!0);const{data:n}=await b.post(`/cajas/${i}/cerrar`);return n.success?(t(u=>({...u,data:u.data.map(m=>m.id===i?n.caja:m)})),!0):(a({msg:n.message}),!1)}catch(n){return a({msg:n.response?.data?.message||"Error al cerrar la caja"}),!1}finally{r(!1)}},fecha:o}}const B=O("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function k({className:l,variant:t,...s}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:T(B({variant:t}),l),...s})}function A({className:l,...t}){return e.jsx("div",{"data-slot":"alert-description",className:T("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",l),...t})}function H({data:l,setData:t,errors:s,processing:r,onSubmit:c,reset:a}){return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"saldo_inicial",children:"Saldo inicial"}),e.jsx(Y,{id:"saldo_inicial",type:"number",step:"0.01",value:l.saldo_inicial??"",onChange:o=>t("saldo_inicial",parseFloat(o.target.value)),className:s.saldo_inicial?"border-red-500":""}),s.saldo_inicial&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.saldo_inicial})]}),e.jsxs("div",{children:[e.jsx($,{label:"Observacion",value:l.observacion??"",onChange:o=>t("observacion",o),error:s.observacion}),s.observacion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.observacion})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:a,disabled:r,children:"Limpiar"}),e.jsx(f,{type:"submit",disabled:r,children:r?"Guardando...":"Guardar"})]})]})}function R({open:l,onClose:t,onSuccess:s}){const{createCaja:r,errors:c,loading:a}=N(),[o,h]=d.useState({saldo_inicial:0,observacion:""}),x=(g,v)=>{h(y=>({...y,[g]:v}))},j=()=>{h({saldo_inicial:0,observacion:""})},p=async g=>{g.preventDefault(),await r(o)&&(j(),s?.(),t())};return e.jsx(S,{open:l,onOpenChange:t,children:e.jsxs(_,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(E,{children:"Aperturar Caja"}),e.jsx(F,{children:"Complete los datos para aperturar una nueva caja."})]}),c.msg&&e.jsx(k,{variant:"destructive",className:"mb-4",children:e.jsx(A,{children:c.msg})}),e.jsx(H,{data:o,setData:x,errors:c,processing:a,onSubmit:p,reset:j})]})})}function V({open:l,onClose:t,caja:s,onSuccess:r}){const{cerrarCaja:c,errors:a}=N(),[o,h]=d.useState(!1),x=async()=>{if(!s)return;h(!0);const j=await c(s.id);h(!1),j&&(r?.(),t())};return e.jsx(S,{open:l,onOpenChange:t,children:e.jsxs(_,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(E,{children:"Cerrar Caja"}),e.jsx(F,{children:s?`¿Estás seguro de cerrar la caja #${s.id} del usuario ${s.user_id}?`:"No se ha seleccionado ninguna caja."})]}),a.msg&&e.jsx(k,{variant:"destructive",className:"mb-4",children:e.jsx(A,{children:a.msg})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(f,{variant:"outline",onClick:t,disabled:o,children:"Cancelar"}),e.jsx(f,{className:"bg-red-500 text-white hover:bg-red-600",onClick:x,disabled:o,children:o?"Cerrando...":"Cerrar Caja"})]})]})})}function z({open:l,onClose:t,caja:s}){const{cerrarCaja:r,errors:c}=N(),[a,o]=d.useState(!1),h=async()=>{if(!s)return;o(!0);const g=await r(s.id);o(!1),g&&t()},x=s?.ingresos_calculados??0,j=s?.egresos_calculados??0,p=s?.saldo_final_calculado??0;return e.jsx(S,{open:l,onOpenChange:t,children:e.jsxs(_,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsxs(E,{children:["Caja #",s?.id]}),e.jsxs(F,{children:["Usuario: ",s?.user?.name||"Desconocido"," ",e.jsx("br",{}),"Estado: ",s?.estado]})]}),c.msg&&e.jsx(k,{variant:"destructive",className:"mb-4",children:e.jsx(A,{children:c.msg})}),s&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50/30 mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2 text-gray-700",children:"Resumen de Caja"}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Total Ingresos:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["Bs ",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Total Egresos:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["Bs ",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm border-t pt-2 mt-2",children:[e.jsx("span",{children:"Saldo Final:"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["Bs ",p.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(f,{variant:"outline",onClick:t,disabled:a,children:"Cerrar"}),s?.estado!=="CERRADA"&&e.jsx(f,{className:"bg-red-500 text-white hover:bg-red-600",onClick:h,disabled:a,children:a?"Cerrando...":"Cerrar Caja"})]})]})})}const G=({cajas:l,loading:t,refreshing:s,onCerrarCaja:r,onShowCaja:c})=>e.jsx("div",{className:"overflow-x-auto bg-default rounded-lg shadow",children:e.jsxs("table",{className:"w-full dark:bg-white/10 table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"Fecha apertura"}),e.jsx("th",{children:"Fecha cierre"}),e.jsx("th",{children:"Total Ingresos"}),e.jsx("th",{children:"Total Egresos"}),e.jsx("th",{children:"Saldo Final"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:l.map(a=>e.jsxs("tr",{className:"hover:bg-gray-200 dark:hover:bg-white/20",children:[e.jsx("td",{className:"p-2",children:a.id}),e.jsx("td",{className:"p-2",children:a.user?.name||"Desconocido"}),e.jsx("td",{className:"p-2",children:M(a.fecha_apertura).format("DD/MM/YYYY HH:mm")}),e.jsx("td",{className:"p-2",children:M(a.fecha_cierre).format("DD/MM/YYYY HH:mm")||"Abierta"}),e.jsx("td",{className:"p-2 text-right",children:a.total_ingresos.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2 text-right",children:a.total_egresos.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2 text-right",children:a.saldo_final?.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2",children:a.estado}),e.jsxs("td",{className:"p-2 text-center",children:[e.jsx(f,{variant:"default",className:"mb-1 w-20",onClick:()=>c?.(a),children:"Ver"}),e.jsx(f,{variant:"warning",className:"mb-1 w-20",onClick:()=>r(a),children:"Cerrar"})]})]},a.id))})]})}),le=()=>{console.log(new Date().toLocaleString());const{cajas:l,loading:t,fetchCajas:s}=N(),[r,c]=d.useState(!1),[a,o]=d.useState(!1),[h,x]=d.useState(null),[j,p]=d.useState(!1),[g,v]=d.useState(null),[y,i]=d.useState(!1);d.useEffect(()=>{s()},[]);const n=async()=>{o(!1),await s()},u=w=>{x(w),p(!0)},m=w=>{v(w),i(!0)},C=()=>{o(!0)};return e.jsxs(I,{breadcrumbs:[{title:"Captaciones",href:route("captaciones.index")}],children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cajas"}),e.jsx(f,{onClick:C,variant:"default",children:"Abrir Caja"})]}),e.jsx(G,{cajas:l.data,loading:t,refreshing:r,onCerrarCaja:u,onShowCaja:m})]}),e.jsx(R,{open:a,onClose:()=>o(!1),onSuccess:n}),e.jsx(V,{open:j,onClose:()=>p(!1),caja:h,onSuccess:s}),e.jsx(z,{open:y,onClose:()=>i(!1),caja:g})]})};export{le as Index,le as default};
