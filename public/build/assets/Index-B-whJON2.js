import{r as u,b as v,j as e}from"./app-Dirc8Dxq.js";import{A as $}from"./app-layout-73mEwPg6.js";import{c as M,b as H,B as j}from"./button-DWW02SMM.js";import{D as S,a as F,b as D,c as _,d as E}from"./dialog-Dn8kM1rh.js";import{I as R}from"./input-C3HqiSkc.js";import{L as B}from"./label-XP6f1jzb.js";import{T as P}from"./TextArea-BsxrIFEh.js";import{d as A}from"./dayjs.min-CC0gb_1d.js";/* empty css            */import"./Edit-HdEDvN3P.js";import"./index-DiaJ5on7.js";import"./createLucideIcon-CDbX26ET.js";import"./index-DpVR0uHb.js";import"./index-DQr8XXov.js";import"./index-CoZuJPrS.js";import"./app-logo-icon-CzPGUPWN.js";function w(){const[i,t]=u.useState({data:[]}),[s,r]=u.useState(!1),[h,a]=u.useState({}),[o,x]=u.useState(""),m=async l=>{try{r(!0),console.log("Fetching cajas...");let n="/cajas";if(l?.fechaInicio||l?.fechaFin){const c=new URLSearchParams;l.fechaInicio&&c.append("fechaInicio",l.fechaInicio),l.fechaFin&&c.append("fechaFin",l.fechaFin),n+=`?${c.toString()}`}const{data:d}=await v.get(n);t(d),x(d.fecha||"")}catch(n){console.error("Error al obtener cajas:",n)}finally{r(!1)}};return{cajas:i,loading:s,errors:h,fetchCajas:m,getCaja:async l=>{try{r(!0);const{data:n}=await v.get(`/cajas/${l}`);return n}catch(n){return console.error("Error al obtener caja:",n),a({msg:"No se pudo obtener el detalle de la caja"}),null}finally{r(!1)}},createCaja:async l=>{console.log("Creating caja with values:",l);try{return r(!0),a({}),await v.post("/cajas",l),!0}catch(n){const d=n;if(d.response?.status===422){const c=d.response.data;typeof c.errors=="object"?a(c.errors):c.message&&a({msg:c.message})}else console.error("Error al crear caja:",d),a({msg:"Error inesperado al crear la caja"});return!1}finally{r(!1)}},updateCaja:async(l,n)=>{try{return r(!0),a({}),await v.put(`/cajas/${l}`,n),await m(),!0}catch(d){const c=d;if(c.response?.status===422){const b=c.response.data;typeof b.errors=="object"?a(b.errors):b.message&&a({msg:b.message})}else a({msg:"Error inesperado al actualizar la caja"});return!1}finally{r(!1)}},deleteCaja:async l=>{if(!confirm("¿Seguro que deseas eliminar esta caja?"))return!1;try{return r(!0),await v.delete(`/cajas/${l}`),await m(),!0}catch(d){return console.error("Error al eliminar caja:",d),a({msg:"No se pudo eliminar la caja"}),!1}finally{r(!1)}},cerrarCaja:async l=>{try{r(!0);const{data:n}=await v.post(`/cajas/${l}/cerrar`);return n.success?(t(d=>({...d,data:d.data.map(c=>c.id===l?n.caja:c)})),!0):(a({msg:n.message}),!1)}catch(n){return a({msg:n.response?.data?.message||"Error al cerrar la caja"}),!1}finally{r(!1)}},fecha:o}}const U=H("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function I({className:i,variant:t,...s}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:M(U({variant:t}),i),...s})}function k({className:i,...t}){return e.jsx("div",{"data-slot":"alert-description",className:M("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",i),...t})}function V({data:i,setData:t,errors:s,processing:r,onSubmit:h,reset:a}){return e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"saldo_inicial",children:"Saldo inicial"}),e.jsx(R,{id:"saldo_inicial",type:"number",step:"0.01",value:i.saldo_inicial??"",onChange:o=>t("saldo_inicial",parseFloat(o.target.value)),className:s.saldo_inicial?"border-red-500":""}),s.saldo_inicial&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.saldo_inicial})]}),e.jsxs("div",{children:[e.jsx(P,{label:"Observacion",value:i.observacion??"",onChange:o=>t("observacion",o),error:s.observacion}),s.observacion&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.observacion})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,disabled:r,children:"Limpiar"}),e.jsx(j,{type:"submit",disabled:r,children:r?"Guardando...":"Guardar"})]})]})}function q({open:i,onClose:t,onSuccess:s}){const{createCaja:r,errors:h,loading:a}=w(),[o,x]=u.useState({saldo_inicial:0,observacion:""}),m=(p,y)=>{x(N=>({...N,[p]:y}))},f=()=>{x({saldo_inicial:0,observacion:""})},g=async p=>{p.preventDefault(),await r(o)&&(f(),s?.(),t())};return e.jsx(S,{open:i,onOpenChange:t,children:e.jsxs(F,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(_,{children:"Aperturar Caja"}),e.jsx(E,{children:"Complete los datos para aperturar una nueva caja."})]}),h.msg&&e.jsx(I,{variant:"destructive",className:"mb-4",children:e.jsx(k,{children:h.msg})}),e.jsx(V,{data:o,setData:m,errors:h,processing:a,onSubmit:g,reset:f})]})})}function z({open:i,onClose:t,caja:s,onSuccess:r}){const{cerrarCaja:h,errors:a}=w(),[o,x]=u.useState(!1),m=async()=>{if(!s)return;x(!0);const f=await h(s.id);x(!1),f&&(r?.(),t())};return e.jsx(S,{open:i,onOpenChange:t,children:e.jsxs(F,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(_,{children:"Cerrar Caja"}),e.jsx(E,{children:s?`¿Estás seguro de cerrar la caja #${s.id} del usuario ${s.user_id}?`:"No se ha seleccionado ninguna caja."})]}),a.msg&&e.jsx(I,{variant:"destructive",className:"mb-4",children:e.jsx(k,{children:a.msg})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(j,{variant:"outline",onClick:t,disabled:o,children:"Cancelar"}),e.jsx(j,{className:"bg-red-500 text-white hover:bg-red-600",onClick:m,disabled:o,children:o?"Cerrando...":"Cerrar Caja"})]})]})})}function G({open:i,onClose:t,caja:s}){const{cerrarCaja:r,errors:h}=w(),[a,o]=u.useState(!1),x=async()=>{if(!s)return;o(!0);const p=await r(s.id);o(!1),p&&t()},m=s?.ingresos_calculados??0,f=s?.egresos_calculados??0,g=s?.saldo_final_calculado??0;return e.jsx(S,{open:i,onOpenChange:t,children:e.jsxs(F,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsxs(_,{children:["Caja #",s?.id]}),e.jsxs(E,{children:["Usuario: ",s?.user?.name||"Desconocido"," ",e.jsx("br",{}),"Estado: ",s?.estado]})]}),h.msg&&e.jsx(I,{variant:"destructive",className:"mb-4",children:e.jsx(k,{children:h.msg})}),s&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50/30 mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2 text-gray-700",children:"Resumen de Caja"}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Total Ingresos:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["Bs ",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Total Egresos:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["Bs ",f.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm border-t pt-2 mt-2",children:[e.jsx("span",{children:"Saldo Final:"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:["Bs ",g.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(j,{variant:"outline",onClick:t,disabled:a,children:"Cerrar"}),s?.estado!=="CERRADA"&&e.jsx(j,{className:"bg-red-500 text-white hover:bg-red-600",onClick:x,disabled:a,children:a?"Cerrando...":"Cerrar Caja"})]})]})})}const J=({cajas:i,loading:t,refreshing:s,onCerrarCaja:r,onShowCaja:h})=>e.jsx("div",{className:"overflow-x-auto bg-default rounded-lg shadow",children:e.jsxs("table",{className:"w-full dark:bg-white/10 table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Usuario"}),e.jsx("th",{children:"Fecha apertura"}),e.jsx("th",{children:"Fecha cierre"}),e.jsx("th",{children:"Total Ingresos"}),e.jsx("th",{children:"Total Egresos"}),e.jsx("th",{children:"Saldo Final"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{className:"hover:bg-gray-200 dark:hover:bg-white/20",children:[e.jsx("td",{className:"p-2",children:a.id}),e.jsx("td",{className:"p-2",children:a.user?.name||"Desconocido"}),e.jsx("td",{className:"p-2",children:A(a.fecha_apertura).format("DD/MM/YYYY HH:mm")}),e.jsx("td",{className:"p-2",children:A(a.fecha_cierre).format("DD/MM/YYYY HH:mm")||"Abierta"}),e.jsx("td",{className:"p-2 text-right",children:a.total_ingresos.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2 text-right",children:a.total_egresos.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2 text-right",children:a.saldo_final?.toFixed(2)||"N/A"}),e.jsx("td",{className:"p-2",children:a.estado}),e.jsxs("td",{className:"p-2 text-center",children:[e.jsx(j,{variant:"default",className:"mb-1 w-20",onClick:()=>h?.(a),children:"Ver"}),e.jsx(j,{variant:"warning",className:"mb-1 w-20",onClick:()=>r(a),children:"Cerrar"})]})]},a.id))})]})}),ue=()=>{console.log(new Date().toLocaleString());const{cajas:i,loading:t,fetchCajas:s}=w(),[r,h]=u.useState(!1),[a,o]=u.useState(!1),[x,m]=u.useState(null),[f,g]=u.useState(!1),[p,y]=u.useState(null),[N,l]=u.useState(!1),[n,d]=u.useState(null),[c,b]=u.useState(null);u.useEffect(()=>{s()},[]);const T=async()=>{o(!1),await s()},O=C=>{m(C),g(!0)},Y=C=>{y(C),l(!0)},L=()=>{o(!0)};return e.jsxs($,{breadcrumbs:[{title:"Captaciones",href:route("captaciones.index")}],children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cajas"}),e.jsx(j,{onClick:L,variant:"default",children:"Abrir Caja"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{children:"Desde:"}),e.jsx("input",{type:"date",value:n||"",onChange:C=>d(C.target.value),className:"border rounded px-2 py-1"}),e.jsx("label",{children:"Hasta:"}),e.jsx("input",{type:"date",value:c||"",onChange:C=>b(C.target.value),className:"border rounded px-2 py-1"}),e.jsx(j,{onClick:()=>s({fechaInicio:n,fechaFin:c}),variant:"outline",children:"Filtrar"})]}),e.jsx(J,{cajas:i.data,loading:t,refreshing:r,onCerrarCaja:O,onShowCaja:Y})]}),e.jsx(q,{open:a,onClose:()=>o(!1),onSuccess:T}),e.jsx(z,{open:f,onClose:()=>g(!1),caja:x,onSuccess:s}),e.jsx(G,{open:N,onClose:()=>l(!1),caja:p})]})};export{ue as Index,ue as default};
