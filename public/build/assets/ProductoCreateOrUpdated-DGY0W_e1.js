import{j as e,r as u,b as _,u as W,c as J}from"./app-BdN3KFFc.js";import{I as y}from"./input-CreckB4S.js";import{c as S,u as T,B as I}from"./button-HnChx-uO.js";import{A as Y}from"./app-layout-BuiHcL-W.js";import{c as Z,u as K,d as M,l as ee}from"./index-C1iwO0xC.js";import{u as re,C as B}from"./index-BalnnUkV.js";import{c as te,X as D}from"./index-CCsJL7g1.js";import{P as R}from"./index-BQOpE9VR.js";import{L as F}from"./label-TE6-Onk7.js";import{T as ae}from"./Toast-CZ26w9z6.js";import{F as se}from"./FloatingCreateButton-B-GQp0IF.js";import{c as P}from"./createLucideIcon-C6ckYpXG.js";/* empty css            */import"./Edit-07XoRN38.js";import"./index-D6oCJvBO.js";import"./app-logo-icon-Bognycb7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ce=P("CircleCheck",oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ie=P("Star",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],de=P("TriangleAlert",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],me=P("Upload",ue);function pe({className:i,...d}){return e.jsx("div",{"data-slot":"card",className:S("bg-card text-card-foreground flex flex-col gap-6 rounded-md border py-6 shadow-sm",i),...d})}function he({items:i,labelKey:d,onSelect:s,selected:t,placeholder:c="Buscar...",displayKey:a,maxResults:p=5,error:h}){const[m,f]=u.useState(""),[l,x]=u.useState(!1),b=u.useRef(null),n=i.filter(r=>(a?a(r):String(r[d])).toLowerCase().includes(m.toLowerCase())).slice(0,p);return u.useEffect(()=>{const r=g=>{g.key==="Escape"&&x(!1)};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),u.useEffect(()=>{const r=g=>{b.current&&!b.current.contains(g.target)&&x(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),e.jsxs("div",{ref:b,className:"relative w-full",children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{onClick:()=>x(!0),className:"cursor-pointer px-4 py-1 pt-2 text-gray-600",children:t?a?a(t):String(t[d]):c}),h&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h})]}),l&&e.jsxs("div",{className:"absolute z-10 w-full bg-white border rounded-md shadow-md",children:[e.jsx(y,{type:"text",value:m,onChange:r=>f(r.target.value),placeholder:c,autoFocus:!0}),e.jsxs("ul",{className:"max-h-60 overflow-y-auto",children:[n.map((r,g)=>e.jsx("li",{onClick:()=>{s(r),f(""),x(!1)},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:a?a(r):String(r[d])},g)),n.length===0&&e.jsx("li",{className:"px-4 py-2 text-gray-400",children:"No se encontraron resultados"})]})]})]})}var E="Checkbox",[xe,$e]=Z(E),[ge,L]=xe(E);function be(i){const{__scopeCheckbox:d,checked:s,children:t,defaultChecked:c,disabled:a,form:p,name:h,onCheckedChange:m,required:f,value:l="on",internal_do_not_use_render:x}=i,[b,n]=K({prop:s,defaultProp:c??!1,onChange:m,caller:E}),[r,g]=u.useState(null),[j,o]=u.useState(null),v=u.useRef(!1),w=r?!!p||!!r.closest("form"):!0,k={checked:b,disabled:a,setChecked:n,control:r,setControl:g,name:h,form:p,value:l,hasConsumerStoppedPropagationRef:v,required:f,defaultChecked:N(c)?!1:c,isFormControl:w,bubbleInput:j,setBubbleInput:o};return e.jsx(ge,{scope:d,...k,children:fe(x)?x(k):t})}var $="CheckboxTrigger",q=u.forwardRef(({__scopeCheckbox:i,onKeyDown:d,onClick:s,...t},c)=>{const{control:a,value:p,disabled:h,checked:m,required:f,setControl:l,setChecked:x,hasConsumerStoppedPropagationRef:b,isFormControl:n,bubbleInput:r}=L($,i),g=T(c,l),j=u.useRef(m);return u.useEffect(()=>{const o=a?.form;if(o){const v=()=>x(j.current);return o.addEventListener("reset",v),()=>o.removeEventListener("reset",v)}},[a,x]),e.jsx(R.button,{type:"button",role:"checkbox","aria-checked":N(m)?"mixed":m,"aria-required":f,"data-state":G(m),"data-disabled":h?"":void 0,disabled:h,value:p,...t,ref:g,onKeyDown:M(d,o=>{o.key==="Enter"&&o.preventDefault()}),onClick:M(s,o=>{x(v=>N(v)?!0:!v),r&&n&&(b.current=o.isPropagationStopped(),b.current||o.stopPropagation())})})});q.displayName=$;var z=u.forwardRef((i,d)=>{const{__scopeCheckbox:s,name:t,checked:c,defaultChecked:a,required:p,disabled:h,value:m,onCheckedChange:f,form:l,...x}=i;return e.jsx(be,{__scopeCheckbox:s,checked:c,defaultChecked:a,disabled:h,required:p,onCheckedChange:f,name:t,form:l,value:m,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{...x,ref:d,__scopeCheckbox:s}),b&&e.jsx(X,{__scopeCheckbox:s})]})})});z.displayName=E;var O="CheckboxIndicator",H=u.forwardRef((i,d)=>{const{__scopeCheckbox:s,forceMount:t,...c}=i,a=L(O,s);return e.jsx(te,{present:t||N(a.checked)||a.checked===!0,children:e.jsx(R.span,{"data-state":G(a.checked),"data-disabled":a.disabled?"":void 0,...c,ref:d,style:{pointerEvents:"none",...i.style}})})});H.displayName=O;var U="CheckboxBubbleInput",X=u.forwardRef(({__scopeCheckbox:i,...d},s)=>{const{control:t,hasConsumerStoppedPropagationRef:c,checked:a,defaultChecked:p,required:h,disabled:m,name:f,value:l,form:x,bubbleInput:b,setBubbleInput:n}=L(U,i),r=T(s,n),g=re(a),j=ee(t);u.useEffect(()=>{const v=b;if(!v)return;const w=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(w,"checked").set,Q=!c.current;if(g!==a&&A){const V=new Event("click",{bubbles:Q});v.indeterminate=N(a),A.call(v,N(a)?!1:a),v.dispatchEvent(V)}},[b,g,a,c]);const o=u.useRef(N(a)?!1:a);return e.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??o.current,required:h,disabled:m,name:f,value:l,form:x,...d,tabIndex:-1,ref:r,style:{...d.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});X.displayName=U;function fe(i){return typeof i=="function"}function N(i){return i==="indeterminate"}function G(i){return N(i)?"indeterminate":i?"checked":"unchecked"}function ve({className:i,...d}){return e.jsx(z,{"data-slot":"checkbox",className:S("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",i),...d,children:e.jsx(H,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(B,{className:"size-3.5"})})})}function C({label:i,placeholder:d,value:s,onChange:t,error:c,rule:a,type:p="text"}){return e.jsxs("div",{className:"relative w-full mb-4",children:[e.jsx(F,{children:i}),a&&e.jsx("span",{className:"text-gray-400 text-xs ms-2",children:a}),e.jsx(y,{type:p,placeholder:d,value:s,onChange:h=>t(h.target.value),className:"peer w-full border rounded-lg p-2 focus:outline-none"}),c&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:c})]})}function je({label:i,placeholder:d,value:s,onChange:t,error:c,rule:a,rows:p=2}){return e.jsxs("div",{className:"relative w-full mb-4",children:[e.jsx(F,{children:i}),a&&e.jsx("span",{className:"text-gray-400 text-xs ms-2",children:a}),e.jsx("textarea",{placeholder:d,value:s,onChange:h=>t(h.target.value),rows:p,className:S("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive")}),c&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:c})]})}const ke=({productoId:i,imagenesGuardadas:d,onUpdated:s})=>{const[t,c]=u.useState(d),[a,p]=u.useState([]),[h,m]=u.useState([]);u.useEffect(()=>{c(d)},[d]);const f=n=>{if(!n.target.files)return;const r=Array.from(n.target.files);m(r);const g=r.map(j=>URL.createObjectURL(j));p(g)},l=async()=>{if(!i||h.length===0)return;const n=new FormData;h.forEach(r=>n.append("imagenes[]",r));try{const{data:r}=await _.post(`/productos/${i}/storeImages`,n,{headers:{"Content-Type":"multipart/form-data"}});c(g=>[...g,...r.imagenes]),p([]),m([]),s?.("Imágenes guardadas correctamente")}catch(r){console.error("Error al subir imágenes:",r.response?.data||r.message),s?.("Error al subir imágenes")}},x=async n=>{if(n)try{const{data:r}=await _.delete(`/productoimagenes/${n}`);r.productoImagenes&&c(r.productoImagenes),s?.(r.message||"Imagen eliminada")}catch(r){console.error("Error al eliminar imagen:",r)}},b=async n=>{if(console.log("esPrincipal"),console.log(n),!!n)try{const r=await _.patch(`/productoimagenes/${n}/setPrincipal`);console.log("result"),console.log(r),c(g=>g.map(j=>({...j,es_principal:j.id===n}))),s?.("Imagen principal actualizada")}catch(r){console.error("Error al establecer imagen principal:",r)}};return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Imágenes del producto"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Configurar imágenes del producto"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(me,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Seleccionar imágenes"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:f})]}),a.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4",children:a.map((n,r)=>e.jsx("img",{src:n,alt:`preview-${r}`,className:"w-full aspect-square rounded-xl overflow-hidden border border-gray-300 object-cover"},r))}),e.jsx(I,{className:"mt-2",onClick:l,children:"Guardar Imágenes"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-6 gap-4",children:t.map(n=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`w-full aspect-square rounded-xl overflow-hidden border ${n.es_principal?"border-blue-500":"border-gray-300"}`,children:e.jsx("img",{src:n.imagen.startsWith("http")?n.imagen:`/storage/${n.imagen}`,alt:`imagen-${n.id}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition",children:[e.jsx("button",{onClick:()=>x(n.id),className:"p-1 bg-red-500 text-white rounded-full shadow hover:bg-red-600",title:"Eliminar",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(n.id),className:`p-1 rounded-full shadow ${n.es_principal?"bg-yellow-400 text-black":"bg-gray-700 text-white hover:bg-yellow-400 hover:text-black"}`,title:"Establecer como principal",children:e.jsx(ie,{className:"w-4 h-4"})})]}),!!n.es_principal&&e.jsx("span",{className:"absolute bottom-2 left-2 bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full shadow",children:"Principal"})]},n.id??n.imagen))})]})},Ne=({productoId:i,preciosGuardados:d,onUpdated:s})=>{const t=new Date().toISOString().split("T")[0],[c,a]=u.useState(d),[p,h]=u.useState({producto_id:i??void 0,precio_venta:0,precio_compra:0,activo:!0,fecha_inicio:t,fecha_fin:null});u.useEffect(()=>{a(d)},[d]);const m=(l,x)=>{h(b=>({...b,[l]:x}))},f=async()=>{if(i)try{const{data:l}=await _.post("/producto-precios",{...p,producto_id:i});console.log("Respuesta al agregar precio:",l),a(l.productoPrecios),h({precio_venta:0,precio_compra:0,activo:!0,fecha_inicio:t,fecha_fin:null}),s?.("Precio agregado correctamente")}catch(l){console.error("Error al agregar precio:",l.response?.data||l.message),s?.("Error al agregar precio")}};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Precios del producto"}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-2",children:[e.jsx(y,{type:"number",placeholder:"Precio venta",value:p.precio_venta,onChange:l=>m("precio_venta",parseFloat(l.target.value))}),e.jsx(y,{type:"number",placeholder:"Precio compra",value:p.precio_compra,onChange:l=>m("precio_compra",parseFloat(l.target.value))}),e.jsx(y,{type:"date",placeholder:"Fecha inicio",value:p.fecha_inicio??t,onChange:l=>m("fecha_inicio",l.target.value)})]}),e.jsx(I,{onClick:f,children:"Agregar precio"}),e.jsx("h2",{className:"text-xl font-semibold mb-2 mt-5",children:"Historial de precios"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto border border-gray-300 rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Precio venta"}),e.jsx("th",{className:"p-2 border",children:"Precio compra"}),e.jsx("th",{className:"p-2 border",children:"Activo"}),e.jsx("th",{className:"p-2 border",children:"Fecha inicio"}),e.jsx("th",{className:"p-2 border",children:"Fecha fin"})]})}),e.jsx("tbody",{children:c.map(l=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"p-2 border",children:l.precio_venta}),e.jsx("td",{className:"p-2 border",children:l.precio_compra}),e.jsx("td",{className:"p-2 border",children:l.activo?e.jsx(B,{className:"text-green-600 w-5 h-5 mx-auto"}):e.jsx(D,{className:"text-red-600 w-5 h-5 mx-auto"})}),e.jsx("td",{className:"p-2 border",children:l.fecha_inicio}),e.jsx("td",{className:"p-2 border",children:l.fecha_fin??"-"})]},l.id))})]})})]})},qe=({categorias:i,onSaved:d,producto:s})=>{const{data:t,setData:c,errors:a}=W({id:s?.id||null,nombre:s?.nombre||"",descripcion:s?.descripcion||"",categoria_id:s?.categoria_id||0,codigo:s?.codigo||null,stock_actual:s?.stock_actual||0,stock_minimo:s?.stock_minimo||0,unidad_medida:s?.unidad_medida||"",activo:s?.activo??!0,precio_compra:s?.precio_activo?.precio_compra??0,precio_venta:s?.precio_activo?.precio_venta??0,saludo:"Hola"}),{flash:p}=J().props,[h,m]=u.useState(p?.success||null),[f,l]=u.useState(s?.categoria||null),x=[{title:"Productos",href:"/productos"}],[b,n]=u.useState(!1),[r,g]=u.useState(t),j=()=>{const o=!!r?.id;console.log("initialData",r);const v=o?route("productos.update",r?.id):route("productos.store");_[o?"put":"post"](v,t).then(k=>{m(k.data.success),g({...t,id:k.data.producto.id}),c("id",k.data.producto.id),n(!1),d?.(k.data.success)}).catch(k=>{k.response?.status===422?console.log(k.response.data.errors):console.error(k)})};return u.useEffect(()=>{console.log("data changed:",t),console.log("initialData:",r);const o=t.nombre!==r.nombre||t.descripcion!==r.descripcion||t.codigo!==r.codigo||t.stock_actual!==r.stock_actual||t.stock_minimo!==r.stock_minimo||t.unidad_medida!==r.unidad_medida||t.activo!==r.activo||t.categoria_id!==r.categoria_id||Number(t.precio_venta)!==Number(r.precio_venta)||Number(t.precio_compra)!==Number(r.precio_compra);n(o)},[t,r]),e.jsxs(Y,{breadcrumbs:x,children:[e.jsx(se,{}),e.jsxs("div",{className:"p-4",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:[r?.id?"Editar":"Crear"," Producto"," ",e.jsx("span",{className:"text--secondary",children:r?.id&&`#${r.id}`})]}),b?e.jsxs("div",{className:"mb-4 flex items-center gap-2 rounded-md bg-yellow-100 p-2 text-yellow-800 text-sm shadow",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{children:"Tienes cambios sin guardar"})]}):s?.id&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 rounded-md bg-green-100 p-2 text-green-800 text-sm shadow",children:[e.jsx(ce,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Producto guardado"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(F,{className:"block text-sm font-medium",children:"Categoria"}),e.jsx(he,{items:i,labelKey:"nombre",placeholder:"Buscar categoría",selected:f,onSelect:o=>{c("categoria_id",o.id),l(o)},error:a.categoria_id})]}),e.jsx("div",{children:e.jsx(C,{label:"Nombre",type:"text",placeholder:"Nombre del producto",value:t.nombre,onChange:o=>c("nombre",o),error:a.nombre})}),e.jsx("div",{children:e.jsx(C,{label:"Código",type:"text",placeholder:"Código del producto",value:t.codigo??"",onChange:o=>c("codigo",o),error:a.codigo})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx(je,{label:"Descripción",value:t.descripcion,placeholder:"Descripción del producto",onChange:o=>c("descripcion",o),error:a.descripcion})}),e.jsx("div",{children:e.jsx(C,{label:"Stock Actual",type:"number",value:t.stock_actual,onChange:o=>c("stock_actual",Number(o)),error:a.stock_actual})}),e.jsx("div",{children:e.jsx(C,{label:"Stock Mínimo",type:"number",value:t.stock_minimo,onChange:o=>c("stock_minimo",Number(o)),error:a.stock_minimo})}),e.jsx("div",{children:e.jsx(C,{label:"Unidad de Medida",type:"text",placeholder:"Ej: kg, unid, lt",value:t.unidad_medida,onChange:o=>c("unidad_medida",o),error:a.unidad_medida})}),e.jsx("div",{children:e.jsx(C,{label:"Precio de Compra",type:"number",value:t.precio_compra,onChange:o=>c("precio_compra",Number(o)),error:a.precio_compra})}),e.jsx("div",{children:e.jsx(C,{label:"Precio de Venta",type:"number",value:t.precio_venta,onChange:o=>c("precio_venta",Number(o)),error:a.precio_venta})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{id:"activo",name:"activo",checked:t.activo,onClick:()=>c("activo",!t.activo)}),e.jsx("label",{htmlFor:"activo",className:"text-sm",children:"Activo"})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(I,{variant:"default",onClick:j,children:"Guardar"})}),e.jsx("div",{className:"mb-6"}),e.jsx(ke,{productoId:s?.id||r.id,imagenesGuardadas:s?.imagenes||[],onUpdated:o=>{m(o)}}),e.jsx(Ne,{productoId:s?.id||r.id,preciosGuardados:s?.precios||[],onUpdated:o=>{m(o)}}),h&&e.jsx(ae,{message:h,onClose:()=>m(null)})]})]})};export{qe as default};
